%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Latex commands and environments to make copyright notices
% on papers
%
%   Authored by Ian McInerney
%       Version:
%           1.0 - Initial release
%           1.1 - Switched to using the background package to add the boxes to the page
%
% This file is released under the Creative Commons BY-SA 4.0 license.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{im-lib-paperCopyright}[2019/01/22 v1.0 IM Library for various author copyright statements]

\RequirePackage{tikz}
% Disable the internal linking of the hyperref package
\RequirePackage[pdftex,hypertexnames=false]{hyperref}

% The background package is the main driver of the overlay
\RequirePackage[pages=some]{background}

% Helper definitions for creating the 
\def\doiurl#1{\href{https://doi.org/#1}{#1}}
\def\copyrightBox#1{\fbox{\parbox{\dimexpr\textwidth-\fboxsep-\fboxrule\relax}{#1}}}

% Create a command to place copyright text into the document of an IEEE paper
% The command goes: \IEEEcopyrightnotice{year}{doi}
\newcommand{\IEEEcopyrighttext}[2]{%
  \footnotesize \textcopyright #1 IEEE. Personal use of this material is permitted.
  Permission from IEEE must be obtained for all other uses, in any current or future
  media, including reprinting/republishing this material for advertising or promotional
  purposes, creating new collective works, for resale or redistribution to servers or
  lists, or reuse of any copyrighted component of this work in other works.
  DOI: \doiurl{#2}%
}

\newcommand{\IEEEcopyrightnotice}[2]{%
    \backgroundsetup{%
        scale=1,             % Don't scale the text
        color=black,         % Black text
        opacity=1,           % No opacity
        placement=bottom,    % Bottom of the page
        nodeanchor=south,    % Anchor on the south of the background image
        vshift=10pt,         % Shift up by 10pt
        contents={\copyrightBox{\IEEEcopyrighttext{#1}{#2}}}
    }
    \BgThispage
}

% Create a command to place copyright text into the document of an IFAC paper
% The command goes: \IFACcopyrightnotice{year}{doi}{publicationName}
% Note, this must be placed _after_ the environments for the abstract and the keywords (such as immediately before the first section command)
\newcommand{\IFACcopyrighttext}[3]{%
  \footnotesize \textcopyright #1 IFAC. This is the authorâ€™s version of a work that was accepted for publication in #3. Changes resulting from the publishing process, such as peer review, editing, corrections, structural formatting, and other quality control mechanisms may not be reflected in this document. Changes may have been made to this work since it was submitted for publication. A definitive version was subsequently published in DOI: \doiurl{#2}}

\newcommand{\IFACcopyrightnotice}[3]{%
	\backgroundsetup{%
        scale=1,             % Don't scale the text
        color=black,         % Black text
        opacity=1,           % No opacity
        placement=bottom,    % Bottom of the page
        nodeanchor=south,    % Anchor on the south of the background image
        vshift=45pt,         % Shift up by 45pt
        contents={\copyrightBox{\IFACcopyrighttext{#1}{#2}{#3}}}
    }
    \BgThispage
}
